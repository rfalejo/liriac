#!/usr/bin/env bash
set -euo pipefail

# Require Python 3.11
if ! command -v python3.11 >/dev/null 2>&1; then
  echo "Python 3.11 is required." >&2
  exit 1
fi

if command -v uv >/dev/null 2>&1; then
  # Use uv-managed venv transparently
  exec uv run -q python -m liriac "$@"
else
  # Fallback: local venv + pip
  if [ ! -d .venv ]; then
    python3.11 -m venv .venv
    source .venv/bin/activate
    python -m pip install -U pip
    python -m pip install -r requirements.txt
  else
    source .venv/bin/activate
  fi
  exec python -m liriac "$@"
fi