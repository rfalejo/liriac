# BL-012 — Library Dashboard (Books & Chapters List)

Status: Planned  
Owner: Frontend  
Last updated: 2025-09-18  
Epic: Frontend SPA

## Summary
Implement the Library dashboard at `/` that lists books and, when a book is selected, shows its chapters. Use React Query for data fetching, `frontend/src/api/endpoints.ts` for typed calls, and Tailwind for layout. Provide basic pagination and loading/empty/error states. This unblocks navigation to the editor route.

## Context
- SPA shell and routing exist (BL-011). Pages scaffolded with headings.
- Typed API client and DTOs exist (BL-010).
- Backend endpoints:
  - `GET /api/v1/books/?page=&search=&ordering=`
  - `GET /api/v1/books/{bookId}/chapters/?page=&ordering=`
- Editor route: `/books/:bookId/chapters/:chapterId` (navigates from chapter rows).
- No global state beyond React Query cache needed for MVP; selected book is local UI state.

## Scope
- Build a Library dashboard UI:
  - Left column: paginated books list (title, created date).
  - Right column: chapters for the selected book (order, title, updated time).
  - Persist selected book in URL query string `?book=<id>` for refresh robustness.
- Interactions:
  - Click a book → sets selected book and loads chapters.
  - Click a chapter → navigates to `/books/:bookId/chapters/:chapterId`.
  - Basic pagination controls (Next/Prev) for both lists when applicable.
  - Optional search box for books by title/slug (debounced).
- States:
  - Loading skeletons/spinners per panel.
  - Empty states with short guidance.
  - Error states with retry.
- Keep components presentational and testable; no global keyboard shortcuts in this ticket.

Out of scope:
- Create/edit flows for books or chapters.
- Infinite scroll or advanced filtering.
- React Query mutations beyond read-only.

## Acceptance Criteria
- Visiting `/` renders:
  - Books list on the left, chapters panel on the right.
  - If `?book=<id>` is present and valid, that book is selected and chapters load.
- Selecting a book updates the query string and loads chapters.
- Clicking a chapter navigates to the editor route.
- Pagination controls appear and work when the backend indicates additional pages.
- Loading, empty, and error states display appropriately.
- Tests:
  - Rendering shows headings (“Library”) and initial loading indicators.
  - Selecting a book triggers chapters fetch (mocked) and renders chapter rows.
  - Chapter click invokes navigation to editor path.
  - Pagination buttons call next/prev page fetches.
- TypeScript strict mode passes; Vitest unit tests pass.

## Implementation Plan
1. Data hooks (React Query):
   - `useBooks(params)` — wraps `listBooks`.
   - `useBookChapters(bookId, params)` — wraps `listBookChapters`.
   - Keep params shape narrow: `{ page?: number; search?: string; ordering?: string }`.
2. Library UI:
   - Replace placeholder in `LibraryPage` with a responsive two-column layout.
   - Left: BooksList component (search + list + pager).
   - Right: ChaptersList component (conditional on selected book + pager).
   - Derive `selectedBookId` from `useSearchParams`; update on selection.
3. Navigation:
   - `onChapterClick` → `navigate(/books/${bookId}/chapters/${chapterId})`.
4. States & UX:
   - Skeleton rows or spinners during `isLoading`.
   - Empty states when `count === 0`.
   - Retry button calls `refetch`.
5. Tests (Vitest + RTL):
   - Mock fetch on endpoints; assert rendered lists, loading, empty, error.
   - Simulate selection and navigation (MemoryRouter + spy on `useNavigate`).
   - Pagination clicks update query and trigger new fetches.
6. Styling:
   - Tailwind classes matching app layout and typography.
   - Accessible semantics: headings, lists with `role="list"`, buttons with labels.

## Test Plan
- Unit tests:
  - Books hook returns data and handles errors via mocked fetch.
  - LibraryPage:
    - Renders headings and loading states.
    - Book selection updates `?book=` and loads chapters.
    - Chapter click navigates to editor route.
    - Pagination triggers subsequent fetches.
- Typecheck:
  - `pnpm run typecheck` passes.
- Lint/format:
  - `pnpm run lint` and `pnpm run format:check` pass.

## Developer Workflow
- Run dev server: `pnpm dev`
- Run tests: `pnpm test`
- Typecheck: `pnpm run typecheck`

## Risks & Mitigations
- Pagination state complexity:
  - Keep page params in URL per panel or reset chapters page to 1 on book change.
- Over-fetch on rapid typing in search:
  - Debounce and cancel previous queries (React Query handles dedupe; add `setTimeout` debounce in input).
- Layout responsiveness:
  - Use standard responsive grid/flex with reasonable min widths.

## Affected Files (planned)
- frontend/src/app/pages/LibraryPage.tsx (replace placeholder with dashboard)
- frontend/src/features/library/BooksList.tsx (new)
- frontend/src/features/library/ChaptersList.tsx (new)
- frontend/src/features/library/hooks.ts (new React Query hooks)
- frontend/src/app/routes.tsx (no change, reference only)
- frontend/src/api/endpoints.ts (reuse existing functions)
- frontend/src/app/__tests__/LibraryPage.test.tsx (new tests)

## Rollback
- Restore previous `LibraryPage` placeholder.
- Remove new feature components/hooks.

## References
- React Query: https://tanstack.com/query/latest
- Testing Library: https://testing-library.com/docs/react-testing-library/intro
- Tailwind CSS: https://tailwindcss.com/docs
- OpenAPI types: `frontend/src/api/types.ts`
