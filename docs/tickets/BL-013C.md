# BL-013C — Consolidate Navigation: Command Palette-First, Editor-Only Shell

Status: Planned
Owners: Frontend
Depends on: BL-013A (Bottom Bar), BL-013B (Top Bar)
Out of scope: Backend API changes

## Objective

Adopt a palette‑first flow and make the Editor the single primary screen. Remove the separate Library page and redundant local UI so navigation/search happens through the Command Palette, with persistent context via the Top Bar and ephemeral feedback in the Bottom Bar.

## Decisions

- Palette over inputs: Remove inline search inputs (e.g., BooksList search). Use the Top Bar’s Command Palette (Cmd/Ctrl+K) for navigation/actions.
- Top Bar actions are canonical: Remove redundant page‑level buttons (“New Book”, “Edit Book”, “New Chapter”) where those actions live in Top Bar quick actions.
- Editor-only shell: Delete the Library route/page. Root (`/`) loads the Editor shell. When no chapter is selected, show a minimal empty state with instructions to “Open Command Palette (Cmd/Ctrl+K) to open a chapter”.
- Breadcrumb and status source of truth:
  - Breadcrumb/context: Top Bar.
  - Ephemeral status and shortcuts: Bottom Bar.
  - Remove the Editor’s local header block.
- Reorder UX remains in list for now: Keep in‑list move/save controls; Top Bar “Reorder” is removed (or wired to focus the controls in a later pass).

## Scope

- Remove Library page and route; prune associated Top/Bottom bar contributions from LibraryPage.
- Remove BooksList inline search.
- Remove redundant buttons in Library/Chapters panels.
- Update EditorPage to:
  - Work without params (empty state).
  - Remove local header; rely on Top/Bottom bars.
  - Keep/adjust Top/Bottom bar contributions and register palette commands.
- Make Editor the root route; keep deep-link route for chapters.
- Update tests, utilities, and docs.

## Implementation Plan

1) Routing
- Update `frontend/src/App.tsx`:
  - Remove Library route and import.
  - Set `/` to render `EditorPage`.
  - Keep `/books/:bookId/chapters/:chapterId` for deep links.
  - Keep Not Found route.

2) Editor empty state
- Update `frontend/src/app/pages/EditorPage.tsx`:
  - If `bookId`/`chapterId` are missing, render a centered empty state:
    - Headline: “Editor”.
    - Helper: “Open the Command Palette (Cmd/Ctrl+K) to open a chapter.”
    - Ensure Top Bar is present; Bottom Bar shows shortcuts.
  - Remove local header block in all states; rely on bars.
  - Maintain current shortcuts: Shift+Tab (Prompt), Esc (blur/close), Cmd/Ctrl+S (push “Save disabled (BL-014)”).

3) Remove inline search and redundant buttons
- `frontend/src/features/library/BooksList.tsx`:
  - Remove the search input and related debounce state; filter via palette only.
- `frontend/src/app/pages/LibraryPage.tsx`:
  - Remove “New Book” and “Edit Book” header buttons (Top Bar provides quick actions).
- `frontend/src/features/library/ChaptersList.tsx`:
  - Remove the “New Chapter” button (Top Bar quick action covers it).
  - Keep reorder controls; remove any Top Bar “Reorder” action registration elsewhere.

4) Top Bar adjustments
- Keep center “Search or jump…” as a palette opener (no inline inputs).
- Ensure `LibraryPage` no longer registers Top Bar contributions (page removed).
- `EditorPage` continues to register breadcrumb/meta; also registers navigation commands from cached lists when available.

5) Tests and helpers
- Remove/replace Library tests:
  - Delete `frontend/src/app/__tests__/LibraryPage.test.tsx`.
  - Delete `frontend/src/features/library/__tests__/*` (BooksList, ChaptersList, dialogs, hooks, reorder).
- Update `frontend/src/App.test.tsx`:
  - Root route renders Editor empty state.
  - Remove assertions for Library.
- Update `frontend/src/features/topbar/__tests__/TopBar.test.tsx`:
  - Keep brand assertion.
  - Keep Cmd/Ctrl+K opens palette.
- Adjust `frontend/src/test/utils.tsx`:
  - Keep providers.
  - Do not duplicate Top/Bottom bars when tests also mount `AppLayout` (avoid double overlays).

6) Docs
- Update `docs/01-technical-spec-en.md` and backlog to reflect palette‑first, editor‑only shell.
- Cross‑link with BL‑013A/B and record this decision as guidance for future routes.

## Acceptance Criteria

- Root (`/`) loads the Editor shell with a minimal empty state and clear instruction to open the palette.
- No Library page exists; no “Books”/“Chapters” dashboard UI is routed.
- No inline list search inputs remain; Command Palette is the only search/jump entry.
- Redundant page‑level buttons are removed; Top Bar quick actions remain the primary affordance.
- Editor with params still loads a chapter, shows Top/Bottom bar context, and preserves existing shortcut behaviors and copy used in tests (e.g., “Save disabled (BL-014)”).
- Updated tests pass reflecting the new navigation model.

## Risks & Mitigations

- Discoverability without Library UI:
  - Mitigate with an explicit empty‑state prompt and palette hotkey hint.
- Users needing list scanning:
  - Enhance palette with grouped items (“Navigate”, “Actions”), include titles/metadata, and leverage React Query cache for items.

## Tasks (Checklists)

- Routing
  - [ ] Remove Library route/import; make `EditorPage` the root.
  - [ ] Keep deep‑link editor route.

- EditorPage
  - [ ] Remove local header.
  - [ ] Add empty state when params missing.
  - [ ] Keep Bottom Bar shortcuts and Top Bar contributions.

- Library feature cleanup
  - [ ] Remove BooksList search input + debounce.
  - [ ] Remove Library header CTAs.
  - [ ] Remove ChaptersList “New Chapter” panel button.

- Palette
  - [ ] Ensure palette registers navigation commands (books/chapters) from cache.

- Tests
  - [ ] Remove Library tests and mocks.
  - [ ] Update App/TopBar tests for Editor‑first shell.
  - [ ] Tidy TestProviders to avoid double providers when wrapping AppLayout.

- Docs
  - [ ] Update technical spec + backlog references.

## Rollback

- Re‑add Library route and page; restore inline search and buttons.
- Revert Editor empty‑state changes.
- Restore removed tests.

