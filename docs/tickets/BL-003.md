# Ticket BL-003: Makefile Workflows for Frontend and Backend

## Description
Introduce a root-level Makefile that wraps common frontend and backend commands to provide a consistent, one-command developer experience across linting, formatting, type checking, testing, running dev servers, and contract generation. Targets should compose cleanly so CI can rely on `make check` to gate merges. Aligns with docs/01-technical-spec-en.md and docs/03-conventions.md.

## Goals
- Single-entry commands for routine tasks (dev, lint, typecheck, test).
- Parity between local and CI execution.
- Clear help output documenting available targets.

## Scope
- Root `Makefile` with phony targets that call:
  - Frontend (pnpm): dev, build, lint, lint:fix, test, typecheck, format, format:check.
  - Backend (uv): ruff, black, mypy (strict), pytest, DRF Spectacular schema.
  - Cross-cutting: `check`, `lint`, `typecheck`, `fmt`, `clean`, `help`.
- Schema and type generation plumbing:
  - `make schema` writes `backend/schema.yaml` using DRF Spectacular.
  - `make fe-typegen` generates `frontend/src/api/types.ts` from `backend/schema.yaml` (openapi-typescript).

## Targets (proposed)
- help: print available targets and short descriptions.
- fe-dev: run Vite dev server.
- fe-build: build frontend (tsc -b + vite build).
- fe-test: run Vitest (CI-friendly).
- fe-lint / fe-lint-fix: run ESLint (and autofix variant).
- fe-typecheck: run `tsc --noEmit`.
- fe-format / fe-format-check: run Prettier write/check.
- run: start Django dev server (ASGI/Channels).
- test: run backend tests with pytest.
- lint: run backend ruff; combine with frontend lint in `check`.
- lint-fix: run ruff with `--fix`.
- typecheck: run mypy (strict).
- fmt: run black (backend) and Prettier (frontend).
- schema: generate OpenAPI schema to `backend/schema.yaml`.
- fe-typegen: generate TypeScript DTOs in `frontend/src/api/types.ts`.
- check: run lint, typecheck, tests (frontend + backend).
- clean: remove Python/coverage caches and frontend build artifacts.

## Acceptance Criteria
- Makefile exists at repo root; `make help` lists targets with one-line descriptions.
- Frontend:
  - `make fe-dev` starts Vite dev server without error.
  - `make fe-build` completes successfully.
  - `make fe-test`, `make fe-lint`, `make fe-typecheck`, `make fe-format-check` exit 0 on current scaffold.
- Backend:
  - `make run` starts Django ASGI server; health endpoint responds 200 at `/api/v1/health/`.
  - `make test` passes existing backend tests.
  - `make lint` (ruff), `make typecheck` (mypy --strict), `make fmt` (black check or write) run successfully.
- Contracts:
  - `make schema` writes/updates `backend/schema.yaml` with no errors.
  - `make fe-typegen` regenerates `frontend/src/api/types.ts` from the schema (no diff vs current for health-only API).
- Composite:
  - `make check` runs lint, typecheck, tests across both frontend and backend and exits 0 on the scaffold.
- CI readiness:
  - Documented CI steps can call `make check` and `make fe-build` reliably.

## Implementation Notes
- Use `uv run` to execute Python tools in backend virtual env:
  - Schema: `uv run python manage.py spectacular --file backend/schema.yaml`
  - Lint: `uv run ruff check .`
  - Format: `uv run black .` (or `--check` variant in `fmt`/`check`).
  - Types: `uv run mypy --strict`
  - Tests: `uv run pytest -q`
- Use `pnpm` in `frontend/`:
  - Lint: `pnpm lint` / `pnpm lint:fix`
  - Format: `pnpm format:check` / `pnpm format`
  - Typecheck: `pnpm typecheck`
  - Build: `pnpm build`
  - Test: `pnpm test`
- `fe-typegen` assumes `openapi-typescript` is available (dev dep or via `pnpm dlx`):
  - Example: `pnpm dlx openapi-typescript backend/schema.yaml -o frontend/src/api/types.ts`

## Testing Strategy
- Manual verification of each target locally:
  - Run all individual targets and confirm exit codes and expected artifacts (schema file, generated types).
  - Run `make check` to ensure composite behavior is correct and order is sensible.
- Spot-check schema/typegen roundtrip:
  - Modify schema minimally (or regenerate) and confirm `fe-typegen` updates DTOs without errors.

## Non-Goals
- Adding new runtime features or changing application logic.
- Introducing additional services or external dependencies beyond tooling wrappers.

## Documentation
- Add short help descriptions to each target so `make help` is self-explanatory.
- Note in README or Makefile header how to install deps:
  - Frontend: `cd frontend && pnpm install`
  - Backend: `cd backend && uv sync` (or `uv pip install -e .[dev]`)
- Reference: docs/01-technical-spec-en.md and docs/03-conventions.md for quality gates and tool choices.
