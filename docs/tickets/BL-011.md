# BL-011 — SPA Shell, Routing, and Layout

Status: Planned  
Owner: Frontend  
Last updated: 2025-09-17  
Epic: Frontend SPA

## Summary
Implement the SPA shell with application layout, top-level routing, and initial screens for the Library Dashboard (`/`) and Editor (`/books/:bookId/chapters/:chapterId`). Provide a minimal, responsive layout with a header, content container, and basic theming hooks. Wire routing and page scaffolds to unblock subsequent features (library lists, editor, suggestions).

## Context
- The frontend is a Vite + React 18 + TypeScript project with Tailwind CSS.
- Current app renders a simple header and description (see `frontend/src/App.tsx` and tests).
- Backlog BL-012 and BL-013 build on this shell (library dashboard and editor).
- URLs must align with the draft spec and backend routes:
  - Dashboard: `/` (books listing later).
  - Editor: `/books/:bookId/chapters/:chapterId`.

## Scope
- Add React Router with two routes and a not-found fallback:
  - `/` → `LibraryPage`
  - `/books/:bookId/chapters/:chapterId` → `EditorPage`
  - `*` → `NotFoundPage` (simple message + link to home)
- Create a shared layout:
  - `AppLayout` with header (brand “liriac”), placeholder nav, and main content container.
  - Light theming hook and Tailwind classes (dark mode-ready via `class="dark"` opt-in).
- Preserve existing heading test; ensure no regressions.
- Provide basic page scaffolds with accessible headings:
  - Library page: “Library”
  - Editor page: “Editor”
- Add a small status/footer area for future autosave/suggestions indicators (static placeholder).
- Ensure routes render without runtime errors and pass Vitest.

Out of scope:
- Fetching data or UI for books/chapters (BL-012).
- Editor textarea, autosave logic, or suggestions UI (BL-013–BL-015).
- Global keyboard shortcuts (will land with editor work).

## Acceptance Criteria
- App renders an application shell with:
  - Header branding: “liriac”.
  - Main container using Tailwind spacing and responsive widths.
- Client-side routing works:
  - Visiting `/` renders Library page with heading “Library”.
  - Visiting `/books/1/chapters/2` renders Editor page with heading “Editor”.
  - Visiting an unknown path renders Not Found with a link to go home.
- Tests:
  - Existing `App.test.tsx` continues to pass.
  - New tests verify route rendering for `/` and editor route.
- TypeScript strict mode compiles with no `any` leakage.
- Project runs with `pnpm dev`, builds with `pnpm build`, and tests with `pnpm test`.

## Implementation Plan
1. Add React Router:
   - Install `react-router-dom` and update `frontend/package.json` (dev already configured; add dep).
   - Create `src/app/routes.tsx` with route definitions.
2. Create layout components:
   - `src/app/layouts/AppLayout.tsx` — header, container, footer placeholder.
3. Create pages:
   - `src/app/pages/LibraryPage.tsx` — “Library” heading and stub text.
   - `src/app/pages/EditorPage.tsx` — read `bookId` and `chapterId` from params; show “Editor” heading and IDs.
   - `src/app/pages/NotFoundPage.tsx` — simple 404 with link to `/`.
4. Wire routes in `src/App.tsx`:
   - Replace static content with Router + `AppLayout` and nested routes.
5. Theming hook (minimal):
   - `src/hooks/useTheme.ts` to read/write theme in `localStorage` (default system or light); expose `theme`, `setTheme`.
   - Apply `className` toggles in layout root container (keep simple; no global dark styles yet).
6. Tests:
   - Update/Add tests in `src/App.test.tsx` or new files:
     - Verify header “liriac” still appears.
     - Render `/` and assert “Library”.
     - Render editor route and assert “Editor”.
     - Render unknown route and assert “Not Found”.
7. Docs:
   - Update this ticket with usage notes; no repo-wide docs changes required.

## Test Plan
- Unit tests (Vitest + RTL):
  - App renders brand header and description (existing test remains).
  - Route smoke tests using `MemoryRouter`:
    - `/` → Library heading present.
    - `/books/1/chapters/2` → Editor heading present; shows params.
    - `/nope` → Not Found text present with link.
- Typecheck:
  - `pnpm run typecheck` passes.
- Lint/format:
  - `pnpm run lint` and `pnpm run format:check` pass.

## Developer Workflow
- Start dev server: `pnpm dev`
- Run unit tests: `pnpm test`
- Typecheck: `pnpm run typecheck`
- Build: `pnpm build`

## Risks & Mitigations
- Router integration breaking existing tests:
  - Keep current header DOM structure and text; assert routes in new tests.
- Theming complexity and CSS churn:
  - Keep theme hook minimal; no heavy CSS changes; dark mode wiring later.
- Future route additions:
  - Centralize route paths in `routes.tsx` to avoid duplication.

## Affected Files (planned)
- frontend/package.json (dependency: `react-router-dom`)
- frontend/src/App.tsx (wire router and layout)
- frontend/src/app/layouts/AppLayout.tsx (new)
- frontend/src/app/pages/{LibraryPage,EditorPage,NotFoundPage}.tsx (new)
- frontend/src/app/routes.tsx (new)
- frontend/src/hooks/useTheme.ts (new)
- frontend/src/App.test.tsx (extend tests or add new test files)

## Rollback
- Revert router wiring in `App.tsx` and remove new layout/pages.
- Remove `react-router-dom` dependency.

## References
- React Router: https://reactrouter.com/
- Tailwind CSS: https://tailwindcss.com/docs/installation
- Testing Library: https://testing-library.com/docs/react-testing-library/intro
